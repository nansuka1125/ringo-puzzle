```html
<!DOCTYPE html>
<html>
<head>
  <title>りんごパズル</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }

    #gameCanvas {
      background-color: #eee;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <script>
    // キャンバスのサイズ
    const canvasWidth = 400;
    const canvasHeight = 400;

    // マスの数
    const gridSize = 5;

    // りんごの色
    const appleColors = ["red", "green", "yellow"];

    // りんごのサイズ
    const appleSize = 60;

    // ゲームの状態
    let isGameOver = false;

    // キャンバスとコンテキストを取得
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // キャンバスのサイズを設定
    canvas.width = canvasWidth;
    canvas.height = canvasHeight;

    // りんごの配列
    let apples = [];

    // ゲーム初期化
    function initializeGame() {
      // りんごの配列を初期化
      apples = [];
      for (let i = 0; i < gridSize * gridSize; i++) {
        apples.push({
          x: (i % gridSize) * appleSize,
          y: Math.floor(i / gridSize) * appleSize,
          color: appleColors[Math.floor(Math.random() * appleColors.length)],
        });
      }
    }

    // りんごを描画
    function drawApples() {
      // りんごを一つずつ描画
      apples.forEach((apple) => {
        ctx.fillStyle = apple.color;
        ctx.beginPath();
        ctx.arc(apple.x + appleSize / 2, apple.y + appleSize / 2, appleSize / 2, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    // りんごを消す
    function removeApples(indices) {
      // 指定されたインデックスのりんごを消す
      indices.forEach((index) => {
        apples.splice(index, 1);
      });
    }

    // 新しいりんごを補充
    function addApples() {
      // 消えたりんごの数だけ新しいりんごを補充
      for (let i = 0; i < apples.length; i++) {
        if (apples[i] === undefined) {
          apples[i] = {
            x: (i % gridSize) * appleSize,
            y: Math.floor(i / gridSize) * appleSize,
            color: appleColors[Math.floor(Math.random() * appleColors.length)],
          };
        }
      }
    }

    // 同じ色のりんごを3つ以上揃える
    function checkMatch() {
      // マスの数だけループ
      for (let i = 0; i < gridSize * gridSize; i++) {
        // 同じ色のりんごを探す
        const matches = findMatches(i);
        // 3つ以上揃っていたら消す
        if (matches.length >= 3) {
          removeApples(matches);
          addApples();
          // ゲームオーバー判定
          if (apples.length === 0) {
            isGameOver = true;
          }
        }
      }
    }

    // 同じ色のりんごを探す
    function findMatches(index) {
      // 同じ色のりんごのインデックスを格納する配列
      let matches = [];
      // 現在のりんごの色
      const currentColor = apples[index].color;
      // 現在のりんごの座標
      const currentX = (index % gridSize) * appleSize;
      const currentY = Math.floor(index / gridSize) * appleSize;
      // 上方向に同じ色のりんごを探す
      let upIndex = index - gridSize;
      while (upIndex >= 0 && apples[upIndex] && apples[upIndex].color === currentColor) {
        matches.push(upIndex);
        upIndex -= gridSize;
      }
      // 下方向に同じ色のりんごを探す
      let downIndex = index + gridSize;
      while (downIndex < gridSize * gridSize && apples[downIndex] && apples[downIndex].color === currentColor) {
        matches.push(downIndex);
        downIndex += gridSize;
      }
      // 左方向に同じ色のりんごを探す
      let leftIndex = index - 1;
      while (leftIndex >= 0 && apples[leftIndex] && apples[leftIndex].color === currentColor && Math.floor(leftIndex / gridSize) === Math.floor(index / gridSize)) {
        matches.push(leftIndex);
        leftIndex--;
      }
      // 右方向に同じ色のりんごを探す
      let rightIndex = index + 1;
      while (rightIndex < gridSize * gridSize && apples[rightIndex] && apples[rightIndex].color === currentColor && Math.floor(rightIndex / gridSize) === Math.floor(index / gridSize)) {
        matches.push(rightIndex);
        rightIndex++;
      }
      // 同じ色のりんごを全て格納する
      matches.push(index);
      return matches;
    }

    // マウスイベント処理
    canvas.addEventListener("click", (event) => {
      // クリックした位置の座標を取得
      const clickX = event.offsetX;
      const clickY = event.offsetY;
      // クリックした位置のりんごのインデックスを取得
      const index = Math.floor(clickY / appleSize) * gridSize + Math.floor(clickX / appleSize);
      // クリックしたりんごと同じ色のりんごを3つ以上揃える
      checkMatch();
      // ゲームオーバー処理
      if (isGameOver) {
        alert("ゲームクリア！");
        initializeGame();
      }
    });

    // ゲーム初期化
    initializeGame();

    // ゲームループ
    function gameLoop() {
      // キャンバスをクリア
      ctx.clearRect(0, 0, canvasWidth, canvasHeight);
      // りんごを描画
      drawApples();
      // 同じ色のりんごを3つ以上揃えるチェック
      checkMatch();
      // ゲームループを継続
      requestAnimationFrame(gameLoop);
    }

    // ゲームループを開始
    gameLoop();
  </script>
</body>
</html>
```












